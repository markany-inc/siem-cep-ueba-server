# SafePC SIEM ê·œì¹™ ê´€ë¦¬ ì‹œìŠ¤í…œ

## 1. ì‹œìŠ¤í…œ ê°œìš”

SafePC SIEMì€ **CEP(Complex Event Processing)**ì™€ **UEBA(User Entity Behavior Analytics)**ë¥¼ í†µí•©í•œ ë³´ì•ˆ ì´ë²¤íŠ¸ íƒì§€ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SafePC Agent (PC)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ ë¡œê·¸ ì „ì†¡
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Kafka (ë©”ì‹œì§€ í)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                     â”‚
               â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CEP (Flink)         â”‚              â”‚      UEBA (Go)           â”‚
â”‚  â€¢ ì‹¤ì‹œê°„ íŒ¨í„´ íƒì§€       â”‚              â”‚  â€¢ í–‰ë™ ë¶„ì„             â”‚
â”‚  â€¢ ì¦‰ì‹œ ì•Œë¦¼/ì°¨ë‹¨         â”‚              â”‚  â€¢ ìœ„í—˜ ì ìˆ˜ ê³„ì‚°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                         â”‚
               â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OpenSearch (ì €ì¥ì†Œ)                             â”‚
â”‚  â€¢ safepc-logs-*     : ì›ë³¸ ë¡œê·¸                                    â”‚
â”‚  â€¢ safepc-alerts-*   : CEP ì•Œë¦¼                                     â”‚
â”‚  â€¢ safepc-ueba-scores-* : UEBA ì ìˆ˜                                 â”‚
â”‚  â€¢ siem-rules        : í†µí•© ê·œì¹™ ì €ì¥ì†Œ â˜…                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Dashboard (ì›¹ UI)                               â”‚
â”‚  â€¢ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§                                                   â”‚
â”‚  â€¢ ê·œì¹™ ê´€ë¦¬ (ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. CEP vs UEBA ì°¨ì´ì 

| êµ¬ë¶„ | CEP (Flink) | UEBA (Go) |
|------|-------------|-----------|
| **ëª©ì ** | ì‹¤ì‹œê°„ íŒ¨í„´ íƒì§€, ì¦‰ì‹œ ëŒ€ì‘ | í–‰ë™ ë¶„ì„, ìœ„í—˜ë„ í‰ê°€ |
| **ì²˜ë¦¬ ë°©ì‹** | ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ (ì´ë²¤íŠ¸ ì¦‰ì‹œ í‰ê°€) | Baseline ë¹„êµ (ê°œì¸ í‰ê·  ëŒ€ë¹„) |
| **ì¶œë ¥** | Alert (ì•Œë¦¼/ì°¨ë‹¨) | Risk Score (ìœ„í—˜ ì ìˆ˜) |
| **ì‹œê°„ ë²”ìœ„** | ìœˆë„ìš° (5ë¶„, 10ë¶„ ë“±) | ëˆ„ì  (7ì¼ Baseline) |
| **ì˜ˆì‹œ** | "5ë¶„ ë‚´ USB 5íšŒ ì—°ê²° â†’ ì•Œë¦¼" | "í‰ì†Œ ëŒ€ë¹„ USB ì‚¬ìš© 200% â†’ +15ì " |

---

## 3. í†µí•© ê·œì¹™ ì €ì¥ì†Œ (siem-rules)

### 3.1 ê·œì¹™ êµ¬ì¡°

```json
{
  "id": "large_file_copy",
  "name": "ëŒ€ìš©ëŸ‰ íŒŒì¼ ë³µì‚¬ (100MB ì´ìƒ)",
  "category": "media_control",
  "weight": 8,
  "enabled": true,
  
  "match": {
    "msgId": "MESSAGE_DEVICE_USAGE",
    "logic": "AND",
    "conditions": [
      {"field": "fileSize", "op": "gte", "value": 104857600}
    ]
  },
  
  "cep": {
    "enabled": false,
    "severity": "HIGH",
    "window": "5m",
    "threshold": 3
  },
  
  "ueba": {
    "enabled": true,
    "useBaseline": true
  },
  
  "createdAt": "2026-02-19T00:00:00Z",
  "updatedAt": "2026-02-19T00:00:00Z"
}
```

### 3.2 ì¡°ê±´ ì—°ì‚°ì

| ì—°ì‚°ì | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| `eq` | ê°™ìŒ | `{"field": "action", "op": "eq", "value": "write"}` |
| `neq` | ë‹¤ë¦„ | `{"field": "outcome", "op": "neq", "value": "success"}` |
| `gt` | ì´ˆê³¼ | `{"field": "fileSize", "op": "gt", "value": 104857600}` |
| `gte` | ì´ìƒ | `{"field": "pageCount", "op": "gte", "value": 50}` |
| `lt` | ë¯¸ë§Œ | `{"field": "count", "op": "lt", "value": 10}` |
| `lte` | ì´í•˜ | `{"field": "count", "op": "lte", "value": 5}` |
| `in` | ëª©ë¡ í¬í•¨ | `{"field": "dayOfWeek", "op": "in", "value": [1, 7]}` |
| `time_range` | ì‹œê°„ëŒ€ | `{"field": "hour", "op": "time_range", "start": 22, "end": 6}` |

### 3.3 í˜„ì¬ ë“±ë¡ëœ ê·œì¹™ (25ê°œ)

#### CEP ê·œì¹™ (17ê°œ)
| ID | ì´ë¦„ | ë“±ê¸‰ | ì¡°ê±´ |
|----|------|------|------|
| cep_agent_uninstall | ì—ì´ì „íŠ¸ ì‚­ì œ | CRITICAL | MESSAGE_AGENT_UNINSTALL |
| cep_malicious_process | ì•…ì„± í”„ë¡œê·¸ë¨ ì‹¤í–‰ | CRITICAL | outcome=blocked, isMalicious=true |
| cep_illegal_photo | ë¶ˆë²•ì´¬ì˜ ê°ì§€ | CRITICAL | eventType=photo |
| cep_large_file_transfer | ëŒ€ìš©ëŸ‰ íŒŒì¼ ì „ì†¡ | HIGH | fileSize > 100MB |
| cep_login_fail | ë¡œê·¸ì¸ ì‹¤íŒ¨ ë°˜ë³µ | HIGH | 5ë¶„ ë‚´ 5íšŒ ì´ìƒ |
| cep_usb_mass_copy | USB ëŒ€ëŸ‰ ë³µì‚¬ | HIGH | 5ë¶„ ë‚´ 5íšŒ ì´ìƒ |
| cep_off_hours_login | ë¹„ì—…ë¬´ì‹œê°„ ì ‘ì† | MEDIUM | 19:00~07:00 |
| cep_weekend_login | ì£¼ë§ ì ‘ì† | MEDIUM | í† /ì¼ìš”ì¼ |
| ... | ... | ... | ... |

#### UEBA ê·œì¹™ (8ê°œ)
| ID | ì´ë¦„ | ê°€ì¤‘ì¹˜ | ì¡°ê±´ |
|----|------|--------|------|
| usb_write_connect | USB ì“°ê¸° ì—°ê²° | 5 | action=write |
| large_file_copy | ëŒ€ìš©ëŸ‰ íŒŒì¼ ë³µì‚¬ | 8 | fileSize â‰¥ 100MB |
| blocked_media_access | ì°¨ë‹¨ ë§¤ì²´ ì ‘ê·¼ | 10 | outcome=blocked |
| print_pii | ê°œì¸ì •ë³´/ê¸°ë°€ ì¸ì‡„ | 12 | isMalicious=true |
| mass_print | ë‹¤ëŸ‰ ì¸ì‡„ | 6 | pageCount â‰¥ 50 |
| screen_capture_drm | í™”ë©´ ìº¡ì²˜ ì°¨ë‹¨ | 8 | outcome=blocked |
| off_hours_access | ë¹„ì—…ë¬´ì‹œê°„ ì ‘ì† | 5 | 22:00~06:00 |
| hacking_tool | í•´í‚¹íˆ´ ì°¨ë‹¨ | 15 | outcome=blocked |

---

## 4. ê·œì¹™ ê´€ë¦¬ ë°©ë²•

### 4.1 ì›¹ UI (Dashboard)

1. http://203.229.154.49:8501/rules ì ‘ì†
2. CEP Rules / UEBA Scoring íƒ­ ì„ íƒ
3. ê·œì¹™ í–‰ í´ë¦­ â†’ ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
4. ê°’ ìˆ˜ì • í›„ ì €ì¥

**ìˆ˜ì • ê°€ëŠ¥ í•­ëª©:**
- CEP: ë“±ê¸‰(severity), ìœˆë„ìš°, ì„ê³„ê°’, ì¡°ê±´ ê°’
- UEBA: ê°€ì¤‘ì¹˜, ì¡°ê±´ ê°’
- ê³µí†µ: í™œì„±í™” ì—¬ë¶€

### 4.2 API

```bash
# ê·œì¹™ ëª©ë¡ ì¡°íšŒ
GET /api/siem-rules

# ê·œì¹™ ìˆ˜ì •
PUT /api/siem-rules/{rule_id}
Content-Type: application/json
{
  "id": "large_file_copy",
  "weight": 10,
  "match": {
    "conditions": [{"field": "fileSize", "op": "gte", "value": 52428800}]
  },
  ...
}
```

### 4.3 ê·œì¹™ ë³€ê²½ ì‹œ ë™ì‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ì €ì¥      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  siem-rules     â”‚
â”‚  Rules UI   â”‚              â”‚  (OpenSearch)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                       â”‚                       â”‚
              â–¼                       â–¼                       â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ UEBA Go   â”‚           â”‚ cep-rules â”‚           â”‚ Flink Job â”‚
       â”‚ /reload   â”‚           â”‚ SQL ìƒì„±   â”‚           â”‚ ì¬ì‹œì‘    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                       â”‚                       â”‚
              â–¼                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         ì¦‰ì‹œ ë°˜ì˜                              â”‚
                                               â–¼
                                         ìƒˆ SQLë¡œ ì‹¤í–‰
```

**ì €ì¥ ì‹œ ìë™ ì²˜ë¦¬:**
1. siem-rules ì €ì¥
2. UEBA: `/reload` API í˜¸ì¶œ â†’ ì¦‰ì‹œ ë°˜ì˜
3. CEP: ì¡°ê±´ â†’ SQL ë³€í™˜ â†’ cep-rules ì €ì¥ â†’ Flink Job ì¬ì‹œì‘

**ì£¼ì˜:** Flink Job ì¬ì‹œì‘ ì‹œ 2~3ì´ˆê°„ íƒì§€ ì¤‘ë‹¨

---

## 5. UEBA ì ìˆ˜ ê³„ì‚° ê³µì‹

```
Risk_t = (Risk_{t-1} Ã— Î») + [Î£(W_i Ã— f(C_i) Ã— M_context) + A_anomaly]
```

| ë³€ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| Î» | ê°ì‡ ìœ¨ (ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ìœ„í—˜ ê°ì†Œ) | 0.9 (7ì¼ ë°˜ê°ê¸°) |
| W_i | ì´ë²¤íŠ¸ ê°€ì¤‘ì¹˜ | 1~15 |
| f(C_i) | ë¹ˆë„ í•¨ìˆ˜ | log(C+1) |
| M_context | ìƒí™© ê°€ì¤‘ì¹˜ (í‡´ì‚¬ì˜ˆì • 2.0, íœ´ê°€ 1.5 ë“±) | 1.0 |
| A_anomaly | ì´ìƒì¹˜ ì ìˆ˜ (Baseline ëŒ€ë¹„ Z-Score) | Î² Ã— max(0, Z-2) |

### ë“±ê¸‰ ê¸°ì¤€

| ë“±ê¸‰ | ì ìˆ˜ | ê¶Œê³  ì¡°ì¹˜ |
|------|------|----------|
| ğŸŸ¢ ê´€ì‹¬ | 0~40 | ë¡œê·¸ ê¸°ë¡ ë° ëª¨ë‹ˆí„°ë§ |
| ğŸŸ¡ ì£¼ì˜ | 41~99 | ë¶€ì„œì¥ ì•Œë¦¼, ëª¨ë‹ˆí„°ë§ ê°•í™” |
| ğŸ”´ ìœ„í—˜ | 100+ | ì¦‰ì‹œ ê³„ì • ì ê¸ˆ, í¬ë Œì‹ ì°©ìˆ˜ |

---

## 6. ì„œë²„ ì •ë³´

| êµ¬ì„±ìš”ì†Œ | ì£¼ì†Œ | ë¹„ê³  |
|----------|------|------|
| SIEM ì„œë²„ | 203.229.154.49 | root / M@rkAny |
| Dashboard | http://203.229.154.49:8501 | ì›¹ UI |
| OpenSearch | http://203.229.154.49:49200 | ë°ì´í„° ì €ì¥ì†Œ |
| OpenSearch Dashboards | http://203.229.154.49:45601 | ë°ì´í„° ì¡°íšŒ |
| Kafka | 43.202.241.121:44105 | ë©”ì‹œì§€ í |
| Flink UI | http://203.229.154.49:48081 | CEP ëª¨ë‹ˆí„°ë§ |

### Docker ì»¨í…Œì´ë„ˆ

```bash
docker ps --format "table {{.Names}}\t{{.Status}}"

# ì£¼ìš” ì»¨í…Œì´ë„ˆ
siem-ueba              # UEBA Go (26MB)
siem-dashboard         # Dashboard (FastAPI)
siem-flink-jobmanager  # CEP Flink
siem-flink-taskmanager
siem-opensearch        # OpenSearch
```

---

## 7. íŒŒì¼ êµ¬ì¡°

```
/Safepc/siem/
â”œâ”€â”€ docker-compose.yml          # UEBA ì„œë¹„ìŠ¤ ì •ì˜
â”œâ”€â”€ ueba/
â”‚   â”œâ”€â”€ main.go                 # UEBA ë©”ì¸ (Kafka Consumer + Baseline)
â”‚   â”œâ”€â”€ go.mod
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ app.py                  # Dashboard API
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ index.html          # ë©”ì¸ ëŒ€ì‹œë³´ë“œ
â”‚       â”œâ”€â”€ rules.html          # ê·œì¹™ ê´€ë¦¬ â˜…
â”‚       â”œâ”€â”€ users.html          # ì‚¬ìš©ì ìœ„í—˜ë„
â”‚       â”œâ”€â”€ alerts.html         # ì•Œë¦¼ ì´ë ¥
â”‚       â”œâ”€â”€ logs.html           # ì´ë²¤íŠ¸ ë¡œê·¸
â”‚       â””â”€â”€ settings.html       # ì„¤ì •
â””â”€â”€ flink/
    â””â”€â”€ docker-compose.yml      # CEP Flink ì„œë¹„ìŠ¤
```

---

## 8. í–¥í›„ ê°œì„  ì‚¬í•­

1. **ê·œì¹™ í…ŒìŠ¤íŠ¸**: ì €ì¥ ì „ dry-runìœ¼ë¡œ ë§¤ì¹­ ê±´ìˆ˜ í™•ì¸
2. **ë³€ê²½ ì´ë ¥**: ê·œì¹™ ìˆ˜ì • ì´ë ¥ ì €ì¥ ë° ë¡¤ë°± ê¸°ëŠ¥
3. **ê·œì¹™ Import/Export**: JSON/YAML íŒŒì¼ë¡œ ê·œì¹™ ë°±ì—…/ë³µì›
4. **LLM ì§€ì›**: ìì—°ì–´ë¡œ ê·œì¹™ ìƒì„± (Bedrock ì—°ë™)
